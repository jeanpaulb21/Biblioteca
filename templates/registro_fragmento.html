<form method="POST" action="{{ url_for('main.agregar_usuario') }}">
  {{ form.hidden_tag() }}

  <!-- Nombre -->
  <div class="mb-3 text-start">
    {{ form.nombre.label(class="form-label") }}
    <div class="input-group">
      <span class="input-group-text"><i class="bi bi-person"></i></span>
      {{ form.nombre(class="form-control", placeholder="Nombre completo") }}
    </div>
    {% for error in form.nombre.errors %}
      <div class="error-message">{{ error }}</div>
    {% endfor %}
  </div>

  <!-- Correo -->
  <div class="mb-3 text-start">
    {{ form.correo.label(class="form-label") }}
    <div class="input-group">
      <span class="input-group-text"><i class="bi bi-envelope"></i></span>
      {{ form.correo(class="form-control", placeholder="Correo electrónico") }}
    </div>
    {% for error in form.correo.errors %}
      <div class="error-message">{{ error }}</div>
    {% endfor %}
  </div>

  <!-- Dirección -->
  <div class="mb-3 text-start">
    {{ form.direccion.label(class="form-label") }}
    <div class="input-group">
      <span class="input-group-text"><i class="bi bi-geo-alt"></i></span>
      {{ form.direccion(class="form-control", placeholder="Dirección") }}
    </div>
    {% for error in form.direccion.errors %}
      <div class="error-message">{{ error }}</div>
    {% endfor %}
  </div>

  <!-- Botón -->
  <div class="d-grid mb-3">
    {{ form.submit(class="btn btn-success w-100") }}
  </div>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const form = document.querySelector('form');

    if (form) {
      form.addEventListener('submit', function (e) {
        e.preventDefault();

        const formData = new FormData(form);

        fetch(form.action, {
          method: 'POST',
          body: formData
        })
          .then(response => response.json())
          .then(data => {
            if (data.success) {
              alert(data.mensaje);
              // Ejemplo: cerrar modal y recargar lista de usuarios
              const modal = bootstrap.Modal.getInstance(document.getElementById('modalLibro'));
              if (modal) modal.hide();
              // Recarga tabla si tienes función para eso:
              // actualizarTablaUsuarios();
            } else {
              alert(data.mensaje || 'Error al registrar usuario.');
              console.log(data.errores || '');
            }
          })
          .catch(err => {
            console.error('Error en la petición:', err);
            alert('Error inesperado al registrar.');
          });
      });
    }
  });
</script>

</form>
