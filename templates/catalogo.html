{% extends "base.html" %}

{% block title %}Catálogo de Libros{% endblock %}

{% block content %}
<div class="container mt-4">
  <h2 class="mb-4 text-accent">Catálogo de Libros</h2>
  <div class="row">
    {% if libros %}
      {% for libro in libros %}
        <div class="col-md-4 col-lg-3 mb-4">
          <div class="card h-100 shadow-sm border-0 position-relative card-hover">
            
            <!-- Botón Favorito / Corazón -->
            {% if current_user.is_authenticated and current_user.rol == 'lector' %}
            <form action="{{ url_for('main.toggle_favorito', libro_id=libro.id) }}" method="POST"
                  class="position-absolute top-0 end-0 m-2">
              <button type="submit" class="btn btn-sm p-0 border-0 bg-transparent">
                <i class="bi {% if libro.id in favoritos_ids %}bi-heart-fill text-danger{% else %}bi-heart text-secondary{% endif %} fs-4"></i>
              </button>
            </form>
            {% endif %}

            <!-- Imagen del libro -->
            <img src="{{ libro.portada_url if libro.portada_url else url_for('static', filename='imagenes/portada_default.png') }}"
                class="card-img-top"
                alt="Portada del libro '{{ libro.titulo }}'"
                style="height: 280px; object-fit: contain; padding: 10px; background-color: #1e293b; border-radius: 8px;">

            <!-- Cuerpo de la tarjeta -->
            <div class="card-body d-flex flex-column">
              <h5 class="card-title text-accent">{{ libro.titulo }}</h5>
              <p class="card-text text-author">Autor: {{ libro.autor }}</p>
              <p class="card-text">
                <small class="text-info">
                  {% if libro.cantidad_disponible > 0 %}
                    Disponible: {{ libro.cantidad_disponible }}
                  {% else %}
                    No disponible
                  {% endif %}
                </small>
              </p>

              <!-- Botones principales -->
              <div class="d-grid gap-2 mt-auto">
                {% if libro.cantidad_disponible > 0 %}
                <a href="{{ url_for('main.reservar_libro_lector', libro_id=libro.id) }}"
                  class="btn btn-success btn-sm w-100">
                  <i class="bi bi-bookmark-check-fill me-1"></i> Reservar
                </a>
                {% else %}
                <button class="btn btn-secondary btn-sm w-100" disabled>
                  <i class="bi bi-bookmark-x me-1"></i> No disponible
                </button>
                {% endif %}

                <a href="{{ url_for('main.detalle_libro', libro_id=libro.id) }}"
                  class="btn btn-outline-primary btn-sm w-100">
                  <i class="bi bi-eye me-1"></i> Ver Detalles
                </a>
              </div>
            </div>
          </div>
        </div>
      {% endfor %}
    {% else %}
      <div class="col-12">
        <div class="alert alert-info">No hay libros disponibles en el catálogo en este momento.</div>
      </div>
    {% endif %}
  </div>
</div>
{% endblock %}
